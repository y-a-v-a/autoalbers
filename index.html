<!DOCTYPE html>
<html>
<head>
    <title>AutoAlbers</title>
    <style>
        html, body {
            padding: 0;
            margin: 0;
        }
        canvas {
            display: block;
            margin: 60px auto 0;
            border: 1px solid #dfdfdf;
        }
        #meter {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            line-height: 0;
        }
        #amount {
            position: relative;
            left: 0;
            top: 0;
            width: 0;
            height: 4px;
            line-height: 0;
            background: #bbb;
        }
    </style>
</head>
<body>
    <canvas id="autoalbers" width="600" height="600"></canvas>
    <div id="meter"><div id="amount"></div></div>
    <script src="color-scheme.js"></script>
    <script>
    (function() {
        var interval
        , duration = 12
        , scale = 1.5
        , canvas = document.getElementById('autoalbers')
        , context = canvas.getContext('2d')

        , createAlbers = function createAlbers() {
            var keyCache = []
            , colors = []
            , getKey = function getKey() {
                var key = getRandomKey(colors.length);
                while (keyCache.indexOf(key) !== -1) {
                    key = getRandomKey(colors.length);
                }
                keyCache.push(key);
                return key;
            }
            , i = 0;

            colors = generateScheme();
            
            for(;i < 4; i +=1) {
                (function(i) {
                    var key = getKey()
                    , x = i * 40 * scale
                    , y = i * 60 * scale
                    , width = (400 * scale) - (i * 80 * scale)
                    , height = (400* scale) - (i * 80 * scale);
                    context.fillStyle = colors[key];
                    context.fillRect(x, y, width, height);
                }(i));
            }
        }
        
        , generateScheme = function generateScheme() {
            var colorScheme = new ColorScheme()
            , hue = Math.floor(Math.random() * 360)
            , schemes = ['mono', 'contrast', 'triade', 'tetrade', 'analogic']
            , variations = ['pastel', 'soft', 'light', 'hard', 'pale']
            , variation = variations[getRandomKey(variations.length)]
            , scheme = schemes[getRandomKey(schemes.length)]
            , distance
            , complement;
            
            colorScheme.from_hue(hue).scheme(scheme).variation(variation);
            if (scheme === 'analogic') {
                complement = !!Math.round(Math.random());
                colorScheme.add_complement(complement);
            }
            if (['mono', 'contrast'].indexOf(scheme) == -1) {
                distance = Math.random();
                colorScheme.distance(distance);
            }

//            console.log(hue, scheme, variation, complement, distance);
            
            return colorScheme.colors();
        }
        
        , getRandomKey = function getRandomKey(max) {
            return Math.floor(Math.random() * max);
        }

        , animate = function animate(seconds) {
            var element = document.getElementById('amount')
            , idx = 0
            , step = (100 / (seconds * 60));
            interval = setInterval(function() {
                element.style.width = (idx * step) + '%';
                idx += 1;
            }, (1e+3 / 60));
        }
        
        , timer = function timer() {
            createAlbers();
            clearInterval(interval);
            animate(duration);
        };

        timer();
        setInterval(timer, duration * 1e+3);
    }());
    </script>
</body>
</html>